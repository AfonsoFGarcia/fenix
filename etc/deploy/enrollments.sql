DELETE FROM mw_CURRICULAR_COURSE_OUTSIDE_STUDENT_DEGREE WHERE idInternal IN (219,241,242,235,236,237,238);

ALTER TABLE ENROLMENT ADD COLUMN FNL_TMP_STATE varchar(4) NOT NULL AFTER STATE;

UPDATE ENROLMENT SET FNL_TMP_STATE = "FNL";

DROP TABLE IF EXISTS NOT_NEED_TO_ENROLL_IN_CURRICULAR_COURSE;
CREATE TABLE NOT_NEED_TO_ENROLL_IN_CURRICULAR_COURSE (
   ID_INTERNAL INT(11) NOT NULL AUTO_INCREMENT,
   ACK_OPT_LOCK INT(11),
   KEY_CURRICULAR_COURSE INT(11) NOT NULL,
   KEY_STUDENT_CURRICULAR_PLAN INT(11) NOT NULL,
   PRIMARY KEY (ID_INTERNAL),
   UNIQUE U1 (KEY_CURRICULAR_COURSE, KEY_STUDENT_CURRICULAR_PLAN)
)TYPE=INNODB;


-- END

-- ISTO É PARA CORRIGIR PLANOS DE ALUNOS QUE APONTAM PARA RAMOS QUE NÃO EXISTEM
SELECT CONCAT('UPDATE STUDENT_CURRICULAR_PLAN SET KEY_SPECIALIZATION_BRANCH = NULL WHERE ID_INTERNAL = ', SCP.ID_INTERNAL, ';') AS ''
FROM STUDENT_CURRICULAR_PLAN SCP
INNER JOIN STUDENT S ON SCP.KEY_STUDENT = S.ID_INTERNAL
LEFT JOIN BRANCH B ON SCP.KEY_SPECIALIZATION_BRANCH = B.ID_INTERNAL
WHERE SCP.KEY_SPECIALIZATION_BRANCH IS NOT NULL AND B.ID_INTERNAL IS NULL;
