#!/bin/sh
# -----------------------------------------------------------------------------
#
#   Runs sql scripts to update database from previous release.
#
# -----------------------------------------------------------------------------
#

DB=$1
USER=$2

echo Using database: $DB
echo Enter password for $USER:
read -s password

function execute() {
	echo ---------------------------------------- $1
	mysql -u$USER -f -p$password --default-character-set=latin1 $DB < $2
	echo
}

function executeWithTempFile() {
	echo ---------------------------------------- $1
	mysql -u$USER -f -p$password --default-character-set=latin1 $DB < $2 > tmp.sql
	mysql -u$USER -f -p$password --default-character-set=latin1 $DB < tmp.sql	
	rm tmp.sql
	echo
}

execute "Alter ROOT_DOMAIN_OBJECT Table" alterRootDomainObjectAndPartyTable.sql
echo '------- TODO: IS NECESSARY ASSOCIATE YOUR INSTITUTION UNIT AND EXTERNAL INSTITUTION UNIT TO ROOT_DOMAIN_OBJECT'
echo '------------- IST EXAMPLE: update ROOT_DOMAIN_OBJECT set `KEY_EXTERNAL_INSTITUTION_UNIT` = 61558;'
echo '-------------------------- update ROOT_DOMAIN_OBJECT set `KEY_INSTITUTION_UNIT` = 61559;'
		   
executeWithTempFile "Migrate ExternalPersons To ExternalContracts" migrateExternalPersons.sql	   
execute "Add AccountabilityType To New ExternalContracts" addAccountabilityTypeToExternalPersons.sql