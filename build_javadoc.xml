<?xml version="1.0" encoding="UTF-8"?>
<project basedir="."
         default="javadoc"
         name="Javadoc generation">

	<property file="development.properties"/>

	<property name="encoding" value="UTF-8"/>
	<property name="lib" location="lib"/>
	<property name="src" location="src"/>
	<property name="src_gen" location="src_gen"/>
	<property name="build.home" location="build"/>
	<property name="build.home.webinf" value="${build.home}/WEB-INF"/>
	<property name="build.home.webinf.classes" value="${build.home.webinf}/classes"/>
	<property name="javadoc" location="javadoc"/>

	<target name="javadoc">
		<mkdir dir="${javadoc}"/>
		<path id="source.path">
			<pathelement path="${src}"/>
			<pathelement path="${src_gen}"/>
		</path>
		<javadoc sourcepathref="source.path" packagenames="*" package="true" encoding="${encoding}"
				linksource="true" link="https://fenix-ashes.ist.utl.pt/home/svn/fenix" maxmemory="1024m" destdir="${javadoc}">
			<classpath>
				<pathelement path="${build.home.webinf.classes}"/>
				<fileset dir="${lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
<!--
			<doclet name="gr.spinellis.umlgraph.doclet.UmlGraph" path="${basedir}/lib/UmlGraph.jar ">
				<param name="-d" value="${uml.dir}"/>
			</doclet>
-->
		</javadoc>
<!--
		<apply executable="dot" dest="${uml.dir}" parallel="false">
			<arg value="-Tpng"/>
			<arg value="-o"/>
			<targetfile/>
			<srcfile/>
			<fileset dir="${uml.dir}" includes="*.dot"/>
			<mapper type="glob" from="*.dot" to="*.png"/>
		</apply>
-->
	</target>

	<target name="publish-javadoc">
		<delete file="fenix-javadoc.zip"/>
		<zip destfile="fenix-javadoc.zip">
			<fileset dir="${javadoc}"/>
		</zip>
		<exec executable="ssh" spawn="true">
			<arg value="-A"/>
			<arg value="${javadoc.username}@${javadoc.hostname}"/>
			<arg value="mkdir /home/javadoc/fenix"/>
		</exec>
		<exec executable="scp">
			<arg value="fenix-javadoc.zip"/>
			<arg value="${javadoc.username}@${javadoc.hostname}:/home/javadoc/fenix/fenix-javadoc.zip"/>
		</exec>
		<exec executable="ssh">
			<arg value="-A"/>
			<arg value="${javadoc.username}@${javadoc.hostname}"/>
			<arg value="cd /home/javadoc/fenix ; unzip -q fenix-javadoc.zip ; rm -rf fenix-javadoc.zip ; chown -R apache:fenix /home/javadoc"/>
		</exec>
		<delete file="fenix-javadoc.zip"/>
	</target>

</project>
