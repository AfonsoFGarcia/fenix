<?xml version="1.0" encoding="ISO-8859-1"?>
<project basedir="." default="generate" name="DML generation and deletion scripts">
	
	<property environment="env"/>
	<property name="encoding" value="ISO-8859-1"/>	

    <!-- Source code directories -->
    <property name="src" location="src"/>
    <property name="src_gen" location="src_gen"/>
    <property name="config" location="config"/>

	<!-- Directories with libraries (JARs) -->
    <property name="lib" location="lib" />
	
	<!-- DML-specific properties -->
	<property name="dml.definition.file" value="domain_model.dml"/>
	
	<target name="generate"
	                description="Generate java code from a DML file">
		<echo message="Processing ${dml.definition.file} ..."/>
		<mkdir dir="${src_gen}"/>
		<java classname="dml.DmlCompiler" fork="true">
			<arg value="-f"/>
			<arg value="-d"/>
			<arg value="${src_gen}"/>
			<arg value="${config}/${dml.definition.file}"/>
			<classpath>
				<fileset dir="${lib}">
					<include name="dml.jar"/>
					<include name="antlr.jar"/>
				</fileset>
			</classpath>
		</java>
		<delete includeEmptyDirs="true">
			<fileset dir="${src_gen}">
				<include name="**/*.java"/>
				<include name="**/Item.java"/>
				<include name="**/InsuranceValue.java"/>
				<include name="**/InsuranceTransaction.java"/>
				<exclude name="**/*_Base.java"/>
				<exclude name="**/I*.java"/>
			</fileset>
	    </delete>
		<echo level="info" message="Processing of ${dml.definition.file} finished."/>
	</target>
	
	<target name="delete-generated-classes"
		                description="Delete generated java classes">
		<delete includeEmptyDirs="true">
			<fileset defaultExcludes="no" dir="${dml.generated.dir}"
		               includes="**/*~,**/#*#,**/*_Base.java"/>
	    </delete>
	</target>

</project>