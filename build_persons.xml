<?xml version="1.0" encoding="ISO-8859-1"?>
<project basedir="." name="CIAPL">

	<property name="sshtools.home" location="lib"/>

    <property environment="env"/>

	<property file="build.properties"/>

    <!-- Directorios com codigo fonte -->
    <property name="src" location="src"/>
	<property name="build.home" location="build"/>

    <!-- Directorios destino da compilacao do projecto -->
	<property name="webapp"          location="${build.home}/app"/>
    <property name="webapp.metadata" value="${webapp}/WEB-INF"/>
    <property name="webapp.classes"  value="${webapp.metadata}/classes"/>
    <property name="webapp.lib"      value="${webapp.metadata}/lib"/>

    <!-- Directorio com bibliotecas (JAR) a utilizar -->
    <property name="lib" location="lib"/>
	<property location="lib_web" name="libs.web"/>

    <!-- Directorio com configuracoes -->
    <property location="config" name="config"/>

    <!-- Directorio com instrucoes SQL -->
    <property location="etc" name="sql"/>

	<!-- Compilation options -->
	<property name="compile.debug"       value="on"/>
  	<property name="compile.deprecation" value="on"/>
  	<property name="compile.optimize"    value="on"/>

	<property name="encoding" value="ISO-8859-15"/>	

    <target name="clean-all" description="Removes any generated files">
		<delete dir="${build.home}"/>
    </target>

	<target name="prepare">
		<!-- Create build directories as needed -->
		<mkdir dir="${webapp.classes}"/>	
		<mkdir dir="${webapp.lib}"/>

		<!-- Copy external dependencies as required -->
		<copy todir="${webapp.metadata}">
			<fileset dir="${basedir}/metadata"/>    
		</copy>

		<copy todir="${webapp.lib}">
			<fileset dir="${basedir}/lib">    
				<exclude name="servlet.jar"/>
				<exclude name="strutstest.jar"/>
			</fileset>
			<fileset dir="${basedir}/lib_web">
				<exclude name="servlet.jar"/>
				<exclude name="strutstest.jar"/>
			</fileset>
		</copy>

		<copy todir="${webapp.classes}">
			<fileset dir="${basedir}/config"/>
		</copy>
	</target>
  
    <target name="compile-proj"
            description="Compila o projecto principal" depends="prepare">
        <tstamp/>
        <javac destdir="${webapp.classes}"
               extdirs="${lib};${libs.web}"
               debug="${compile.debug}"
               optimize="${compile.optimize}"
               deprecation="${compile.deprecation}"
               encoding="${encoding}"
               memoryInitialSize="512m"
               memoryMaximumSize="512m"
               fork="yes">
			<src path="${src}"/>
        </javac>
		<replace dir="${webapp.metadata}" propertyFile="build.properties">
	    	<include name="**/**/*.xml"/>
	    	<include name="**/**/ApplicationResources.properties"/>

			<replacefilter token="&lt;!-- @validation.doctype@ -->" property="validation.doctype"/>

			<replacefilter token="@login.page@" property="login.page"/>

			<replacefilter token="@db.user@" property="db.user"/>
			<replacefilter token="@db.pass@" property="db.pass"/>
			<replacefilter token="@db.name@" property="db.name"/>
			<replacefilter token="@db.alias@" property="db.alias"/>
			<replacefilter 
				token="@db.personFilter.user@" 
			    property="db.personFilter.user"/>
			<replacefilter 
			    token="@db.personFilter.pass@" 
			    property="db.personFilter.pass"/>
			<replacefilter 
			    token="@db.personFilter.name@" 
			    property="db.personFilter.name"/>
			<replacefilter 
			    token="@db.personFilter.alias@" 
			    property="db.personFilter.alias"/>
			<replacefilter 
			    token="@db.personFilter.platform@" 
			    property="db.personFilter.platform"/>
			<replacefilter 
			    token="@db.personFilter.driver@" 
			    property="db.personFilter.driver"/>
			<replacefilter 
			    token="@db.personFilter.protocol@" 
			    property="db.personFilter.protocol"/>
			<replacefilter 
			    token="@db.personFilter.subprotocol@" 
			    property="db.personFilter.subprotocol"/>
			<replacefilter 
			    token="@db.personFilter.validationQuery@" 
			    property="db.personFilter.validationQuery"/>
			<replacefilter 
			    token="@db.personFilter.other@" 
			    property="db.personFilter.other"/>
			<replacefilter 
			    token="@db.personFilter.errorFile@" 
			    property="db.personFilter.errorFile"/>
		  	<replacefilter 
			    token="@db.personFilter.log@" 
			    property="db.personFilter.log"/>
	
			<replacefilter token="@application@" property="application"/>
		</replace>
    </target>
    
	<target name="all_persons" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroTodasPessoas" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="pessoa-todos.dat"/>
		</java>
	</target>

	<target name="ina_persons" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroPessoasInactivas" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="pessoa-activos.dat"/>
		</java>
	</target>
    
	<target name="update_persons" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroActualizarPessoas" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="pessoa-activos.dat"/>
		</java>
	</target>
    
	<target name="update_employees" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroActualizarFuncionarios" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="funcionario.dat"/>
		</java>
	</target>
    
	<target name="update_teachers" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroActualizarFuncsDocentes" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="docente.dat"/>
		</java>
	</target>
    
	<target name="update_not_teachers" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroActualizarFuncsNaoDocentes" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="naodocente.dat"/>
		</java>
	</target>				
	
	<target name="update_mail_cc" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroInicializarCorreioFuncionarios" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="funcionario-correio.dat"/>
		</java>
	</target>
	
	<target name="update_work_cc" depends="compile-proj">
		<java classname="middleware.personAndEmployee.ServicoSeguroInicializarLocalTrabalhoFuncionarios" fork="yes"
			failonerror="false" maxmemory="896m">
			<classpath>
				<pathelement path="${webapp.classes}"/>
				<pathelement path="${config}"/>
				<pathelement path="${sql}"/>
				<pathelement path="${src}"/>
				<fileset dir="${webapp.lib}">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
			<arg line="centro-custo-afecto.dat"/>
		</java>
	</target>
</project>