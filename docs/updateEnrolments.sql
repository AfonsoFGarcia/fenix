SELECT CONCAT('INSERT INTO ENROLMENT_EVALUATION VALUES (NULL, NULL, 1, NULL, NULL, NULL, 2, ', E.ID_INTERNAL, ', NULL, NULL, NULL, NULL, 1);') AS ""
FROM ENROLMENT E
INNER JOIN CURRICULAR_COURSE CC ON E.KEY_CURRICULAR_COURSE = CC.ID_INTERNAL
INNER JOIN DEGREE_CURRICULAR_PLAN DCP ON CC.KEY_DEGREE_CURRICULAR_PLAN = DCP.ID_INTERNAL
INNER JOIN STUDENT_CURRICULAR_PLAN SCP ON E. KEY_STUDENT_CURRICULAR_PLAN = SCP.ID_INTERNAL
INNER JOIN STUDENT S ON SCP.KEY_STUDENT = S.ID_INTERNAL
LEFT JOIN ENROLMENT_EVALUATION EE ON EE.KEY_ENROLMENT = E.ID_INTERNAL
WHERE EE.ID_INTERNAL IS NULL AND E.KEY_EXECUTION_PERIOD = 80;


SELECT CONCAT('UPDATE ENROLMENT_EVALUATION SET STATE = 1 WHERE ID_INTERNAL = ', ID_INTERNAL, ';') AS ""
FROM ENROLMENT_EVALUATION WHERE GRADE IS NOT NULL AND STATE = 2;


DROP TABLE IF EXISTS XPTO;
CREATE TABLE XPTO
SELECT EE1.* FROM ENROLMENT_EVALUATION EE1
INNER JOIN ENROLMENT_EVALUATION EE2 ON
EE1.KEY_ENROLMENT = EE2.KEY_ENROLMENT
WHERE
EE1.GRADE IS NULL AND
EE2.GRADE IS NULL AND
EE1.ID_INTERNAL <> EE2.ID_INTERNAL;


DROP TABLE IF EXISTS XPTI;
CREATE TABLE XPTI
SELECT * FROM ENROLMENT_EVALUATION WHERE GRADE IS NULL GROUP BY KEY_ENROLMENT HAVING COUNT(*) > 1;


SELECT CONCAT('DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = ', EE.ID_INTERNAL, ';') AS ""
FROM ENROLMENT_EVALUATION EE
INNER JOIN XPTO X ON X.ID_INTERNAL = EE.ID_INTERNAL;

SELECT CONCAT('INSERT INTO ENROLMENT_EVALUATION VALUES (NULL, NULL, 1, NULL, NULL, NULL, 2, ', KEY_ENROLMENT, ', NULL, NULL, NULL, NULL, 1);') AS ""
FROM XPTI;

DROP TABLE IF EXISTS XPTO;
DROP TABLE IF EXISTS XPTI;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 25417 WHERE ID_INTERNAL = 487121;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 25430;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44018;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 25417;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 26406 WHERE ID_INTERNAL = 530406;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 26419;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44020;
UPDATE ENROLMENT SET STATE = 6 WHERE ID_INTERNAL = 26406;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28451 WHERE ID_INTERNAL = 487498;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28464;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44033;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 28451;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28456 WHERE ID_INTERNAL = 487500;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28469;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44034;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 28456;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28467 WHERE ID_INTERNAL = 487501;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28480;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44035;
UPDATE ENROLMENT SET STATE = 2 WHERE ID_INTERNAL = 28467;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28473 WHERE ID_INTERNAL = 487503;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28486;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44036;
UPDATE ENROLMENT SET STATE = 2 WHERE ID_INTERNAL = 28473;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28501 WHERE ID_INTERNAL = 530448;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28514;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44037;
UPDATE ENROLMENT SET STATE = 6 WHERE ID_INTERNAL = 28501;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28511 WHERE ID_INTERNAL = 487505;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28524;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44038;
UPDATE ENROLMENT SET STATE = 2 WHERE ID_INTERNAL = 28511;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 28516 WHERE ID_INTERNAL = 487506;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 28529;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44039;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 28516;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 29477 WHERE ID_INTERNAL = 487571;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 29490;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44040;
UPDATE ENROLMENT SET STATE = 2 WHERE ID_INTERNAL = 29477;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34703 WHERE ID_INTERNAL = 530468;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34716;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44054;
UPDATE ENROLMENT SET STATE = 6 WHERE ID_INTERNAL = 34703;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34732 WHERE ID_INTERNAL = 530496;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34745;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44059;
UPDATE ENROLMENT SET STATE = 6 WHERE ID_INTERNAL = 34732;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34738 WHERE ID_INTERNAL = 530500;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34751;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44060;
UPDATE ENROLMENT SET STATE = 6 WHERE ID_INTERNAL = 34738;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34744 WHERE ID_INTERNAL = 530503;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34757;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 44061;
UPDATE ENROLMENT SET STATE = 6 WHERE ID_INTERNAL = 34744;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34709 WHERE ID_INTERNAL = 489276;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34722;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 468315;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 34709;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34714 WHERE ID_INTERNAL = 489277;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34727;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 468316;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 34714;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34719 WHERE ID_INTERNAL = 489278;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34732;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 468317;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 34719;

UPDATE ENROLMENT_EVALUATION SET KEY_ENROLMENT = 34726 WHERE ID_INTERNAL = 489279;
DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 34739;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 468318;
UPDATE ENROLMENT SET STATE = 1 WHERE ID_INTERNAL = 34726;


DELETE FROM ENROLMENT WHERE ID_INTERNAL = 496479;
DELETE FROM ENROLMENT_EVALUATION WHERE KEY_ENROLMENT = 496479;

DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = 537423;
DELETE FROM ENROLMENT WHERE ID_INTERNAL = 475866;

UPDATE ATTEND SET KEY_ENROLMENT = 488683 WHERE KEY_STUDENT = 10047 AND KEY_EXECUTION_COURSE = 36741;
UPDATE ATTEND SET KEY_ENROLMENT = 488612 WHERE KEY_STUDENT = 9699 AND KEY_EXECUTION_COURSE = 36741;
UPDATE ATTEND SET KEY_ENROLMENT = 495618 WHERE KEY_STUDENT = 9512 AND KEY_EXECUTION_COURSE = 36741;

-- **************************************************************************************************

-- SELECT S.NUMBER,
-- CC1.CODE,CC1.NAME,
-- E1.ID_INTERNAL,E1.STATE,E1.KEY_EXECUTION_PERIOD,
-- EE1.GRADE,
-- CC2.CODE,CC2.NAME,
-- E2.ID_INTERNAL,E2.STATE,E2.KEY_EXECUTION_PERIOD,
-- EE2.GRADE FROM STUDENT S
-- INNER JOIN STUDENT_CURRICULAR_PLAN SCP ON SCP.KEY_STUDENT = S.ID_INTERNAL
-- INNER JOIN ENROLMENT E1 ON E1.KEY_STUDENT_CURRICULAR_PLAN = SCP.ID_INTERNAL
-- INNER JOIN ENROLMENT E2 ON E2.KEY_STUDENT_CURRICULAR_PLAN = SCP.ID_INTERNAL
-- INNER JOIN CURRICULAR_COURSE CC1 ON E1.KEY_CURRICULAR_COURSE = CC1.ID_INTERNAL
-- INNER JOIN CURRICULAR_COURSE CC2 ON E2.KEY_CURRICULAR_COURSE = CC2.ID_INTERNAL
-- INNER JOIN ENROLMENT_EVALUATION EE1 ON EE1.KEY_ENROLMENT = E1.ID_INTERNAL
-- INNER JOIN ENROLMENT_EVALUATION EE2 ON EE2.KEY_ENROLMENT = E2.ID_INTERNAL
-- WHERE
-- SCP.KEY_DEGREE_CURRICULAR_PLAN = 48 AND
-- E1.ID_INTERNAL <> E2.ID_INTERNAL AND
-- CC1.CODE = 'SE' AND CC2.CODE = 'ASM'
-- ORDER BY S.NUMBER


-- SELECT CONCAT('DELETE FROM ENROLMENT WHERE ID_INTERNAL = ', E1.ID_INTERNAL, ';DELETE FROM ENROLMENT_EVALUATION WHERE ID_INTERNAL = ', EE1.ID_INTERNAL, ';') AS ""
-- FROM STUDENT S
-- INNER JOIN STUDENT_CURRICULAR_PLAN SCP ON SCP.KEY_STUDENT = S.ID_INTERNAL
-- INNER JOIN ENROLMENT E1 ON E1.KEY_STUDENT_CURRICULAR_PLAN = SCP.ID_INTERNAL
-- INNER JOIN ENROLMENT E2 ON E2.KEY_STUDENT_CURRICULAR_PLAN = SCP.ID_INTERNAL
-- INNER JOIN CURRICULAR_COURSE CC1 ON E1.KEY_CURRICULAR_COURSE = CC1.ID_INTERNAL
-- INNER JOIN CURRICULAR_COURSE CC2 ON E2.KEY_CURRICULAR_COURSE = CC2.ID_INTERNAL
-- INNER JOIN ENROLMENT_EVALUATION EE1 ON EE1.KEY_ENROLMENT = E1.ID_INTERNAL
-- INNER JOIN ENROLMENT_EVALUATION EE2 ON EE2.KEY_ENROLMENT = E2.ID_INTERNAL
-- WHERE
-- SCP.KEY_DEGREE_CURRICULAR_PLAN = 48 AND
-- E1.ID_INTERNAL <> E2.ID_INTERNAL AND
-- CC1.CODE = 'SE' AND CC2.CODE = 'ASM'
-- ORDER BY S.NUMBER
